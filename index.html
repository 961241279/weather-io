<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather.io</title>
    <link rel="icon" href="icon.png">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;0,400;0,500;0,600;0,700;0,800;0,900;1,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://pv.sohu.com/cityjson?ie=utf-8"></script>
    <script src="js/Convert_Pinyin.js"></script>
    <script>
let weather = {
  apiKey: "13e786b2255800d48474a6fdbcd071dc",
  fetchWeather: function (city) {
   city=city.replace('aer','ar');
   city=city.replace('eer','er');
   city=city.replace('ier','ir');
   city=city.replace('oer','or');
   city=city.replace('uer','ur');
   city=city.replace('gg','g');
    fetch(
      "https://api.openweathermap.org/data/2.5/weather?q=" +
        city +
        "&units=metric&appid=" +
        this.apiKey
    )
      .then((response) => response.json())
      .then((data) => this.displayWeather(data));
  },
  displayWeather: function (data) {
    const { name } = data;
    const { icon, description } = data.weather[0];
    const { temp, humidity } = data.main;
    const { speed } = data.wind;
    document.querySelector(".city").innerText = "Weather in " + name;
    document.querySelector(".icon").src =
      "https://openweathermap.org/img/wn/" + icon + ".png";
    document.querySelector(".description").innerText = description;
    document.querySelector(".temp").innerText = temp + "°C";
    document.querySelector(".humidity").innerText =
      "湿度: " + humidity + "%";
    document.querySelector(".wind").innerText =
      "风速: " + speed + " km/h";
    document.querySelector(".weather").classList.remove("loading");
    document.body.style.backgroundImage =
      "url('https://source.unsplash.com/1600x900/?city " + name + "')";
    document.body.style.backgroundRepeat = "none";
    document.body.style.backgroundSize = "100";
    document.body.style.width = "100%";
    document.body.style.height = "100%";
    document.body.style.backgroundRepeat = "no-repeat";
    document.body.style.backgroundSize = "cover";

  },
  search: function () {
   var city = document.getElementById("searchBarId").value;
    var cityName = pinyin.getFullChars(city);

          if(cityName .length>0){
          var first = cityName.substr(0,1).toUpperCase();
          var spare = cityName.substr(1,cityName.length);
          cityName = first + spare;
          }
    this.fetchWeather(cityName);
  },
};

function search(){
  weather.search();
}

function keyup(event){
   if (event.key == "Enter") {
       search();
   }
}
    </script>
</head>

<body onload="myFunction()">
    <div id="loading"></div>
    <div class="cont">
        <div class="one">
            <h1>🌦️ Weather.io ☔️</h1>
        </div>
    </div>
    <div class="two">
        <div class="card">
            <div class="search">
                <input type="text" class="search-bar" id="searchBarId" placeholder="Search" onKeyUp="keyup(event)" />
                <button onClick="search()">
                    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="1em"
                        width="1.5em" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd"
                            d="M10.442 10.442a1 1 0 011.415 0l3.85 3.85a1 1 0 01-1.414 1.415l-3.85-3.85a1 1 0 010-1.415z"
                            clip-rule="evenodd"></path>
                        <path fill-rule="evenodd"
                            d="M6.5 12a5.5 5.5 0 100-11 5.5 5.5 0 000 11zM13 6.5a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z"
                            clip-rule="evenodd"></path>
                    </svg>
                </button>
            </div>
            <div class="weather loading">
				<div class="other">注意：请输入城市名仅包含名称不含市县</div>
                <h2 class="city">Weather in Shanghai</h2>
                <h1 class="temp">21°C</h1>
                <div class="flex">
                    <img src="https://openweathermap.org/img/wn/04d.png" alt="" class="icon" />
                    <div class="description">多云</div>
                </div>
                <div class="other">
                    <div class="humidity">湿度: 60%</div>
                    <div class="wind">风速: 6.2 km/h</div>
                </div>
            </div>
        </div>
    </div>
    <script>
        var preloader = document.getElementById('loading');
        function myFunction() {
            preloader.style.display = 'none';
        }
     function localWeather(obj) {
          console.log(obj);
          var city = obj.city;

          city = city.substring(0,city.length-1);

          var cityName = pinyin.getFullChars(city);

          if(cityName .length>0){
          var first = cityName.substr(0,1).toUpperCase();
          var spare = cityName.substr(1,cityName.length);
          cityName = first + spare;
          }

          console.log(cityName);
          weather.fetchWeather(cityName);

}
       
  var url = "https://restapi.amap.com/v3/ip?callback=localWeather&key=" + "6d9c7e2448f6b3532d080f3a6cedad11" + "&ip=" + returnCitySN.cip;
  var jsapi = document.createElement('script');
  jsapi.charset = 'utf-8';
  jsapi.src = url;
  document.head.appendChild(jsapi);

    </script>
    <script type="text/javascript" src="js/vanilla-tilt.js"></script>
    <script type="text/javascript">
        VanillaTilt.init(document.querySelector(".card"), {
            max: 15,
            glare: true,
            reverse: true,
            "max-glare": 0.5,
            speed: 400
        });
        VanillaTilt.init(document.querySelectorAll(".card"));
    </script>
</body>